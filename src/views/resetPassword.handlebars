<div class="container my-5" style="max-width: 450px;">
  <div class="card shadow-sm">
    <div class="card-body">
      <h2 class="card-title text-center mb-4">Restablecer contraseña</h2>

      {{#if message}}
        <div class="alert alert-{{messageType}} text-center" id="alertMessage">
          {{message}}
        </div>
      {{/if}}

      <form action="/api/sessions/reset-password" method="POST" class="needs-validation" novalidate>
        <input type="hidden" name="token" value="{{token}}" />

        <div class="mb-3">
          <label for="newPassword" class="form-label">Nueva contraseña</label>
          <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="Nueva contraseña" required>
          <div class="invalid-feedback">
            Por favor ingresa tu nueva contraseña.
          </div>
        </div>

        <div class="mb-3">
          <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
          <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Repite la contraseña" required>
          <div class="invalid-feedback">
            Las contraseñas no coinciden o están vacías.
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Restablecer contraseña</button>
      </form>

      <div class="mt-3 text-center">
        <a href="/login" class="text-decoration-none">Volver al login</a>
      </div>
    </div>
  </div>
</div>

<script>
  // Validación de Bootstrap
  (() => {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        const newPassword = form.querySelector('#newPassword').value;
        const confirmPassword = form.querySelector('#confirmPassword').value;

        if (!form.checkValidity() || newPassword !== confirmPassword) {
          event.preventDefault();
          event.stopPropagation();

          if(newPassword !== confirmPassword){
            form.querySelector('#confirmPassword').setCustomValidity("Contraseñas no coinciden");
          } else {
            form.querySelector('#confirmPassword').setCustomValidity("");
          }
        } else {
          form.querySelector('#confirmPassword').setCustomValidity("");
        }

        form.classList.add('was-validated');
      }, false)
    })
  })();

  // Redirección automática si es éxito
  const alertMessage = document.getElementById('alertMessage');
  if (alertMessage && alertMessage.classList.contains('alert-success')) {
    setTimeout(() => {
      window.location.href = "/login";
    }, 3000); // 3 segundos
  }
</script>